var express = require('express');
var router = express.Router();
var mongodb = require('mongodb');
var assert = require('assert');

url="mongodb://localhost:27017"

router.get("/", (req, res, next) => {
  res.render("student");
});
 

router.get("/get-data", (req, res, next) => {
    var resultArray = [];
    mongodb.connect(url, function (err, db){
       assert.equal(null, err);
       var cursor = db.collection('std-data').find();
       cursor.forEach(function(doc, err){
         assert.equal(null,err);
         resultArray.pust(doc);
       }, function(){
         db.close();
         res.render('student', { items : resultArray });
       });
    });
});

router.post("/insert", (req, res, next) => {
  var item = {
     regno : req.body.regno,
     sname : req.body.sname,
     course : req.body.course,
     dob : req.body.dob
  }
   
  mongodb.connect(url, (err,db) => {
    assert.equal(null,err);
    db.collection('std-data').insertOne(item, function(err, result){
        assert.equal(null,err);
        console.log("data inserted");        
     });
  });
res.redirect('/');
   
});

